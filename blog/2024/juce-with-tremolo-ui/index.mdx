---
title: JUCEã®UIã‚’ @tremolo-ui/react ã§ä½œã‚‹
date: 2024-12-7
tags:
- JUCE
- WebView
- React
- tremolo-ui
- 2024
---

import captureVideo from './capture.mp4'

<AdventCalendar day={3} />

ã“ã®è¨˜äº‹ã¯ã€[JUCE Advent Calendar 2024](https://qiita.com/advent-calendar/2024/juce) ã®3æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

<Flex
  justifyContent={'space-around'}
>

[\< 2æ—¥ç›®ã®è¨˜äº‹](./juce-framework-frontend-mirror)

[4æ—¥ç›®ã®è¨˜äº‹ \>](https://atsushieno.hatenablog.com/entry/2024/12/04/002624)

</Flex>

## ã¯ã˜ã‚ã«

3æ—¥ç›®ã® [mimoz](https://x.com/m1m0zzz) ã§ã™ã€‚è‰²ã€…å¿™ã—ãã€ã‹ãªã‚Šé…ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã™ã„ã¾ã›ã‚“ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€ç§ãŒç¾åœ¨é–‹ç™ºã—ã¦ã„ã‚‹ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã®UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª **tremolo-ui** ã‚’ä½¿ã„ã€JUCEã®UIã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

å®Ÿã¯ã€ã“ã®è¨˜äº‹ã®åŸ·ç­†ã«åˆã‚ã›ã¦ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é…ä¿¡ã®æº–å‚™ã‚’é€²ã‚ã¦ã„ãŸã®ã§ã™ãŒã€JavaScriptãƒãƒ³ãƒ‰ãƒ©ãƒ¼å‘¨ã‚ŠãŒä¸Šæ‰‹ãè¡Œã‹ãšã€ã‚µãƒ³ãƒ—ãƒ«ãŒã ã„ã¶è³ªç´ ãªè¦‹ãŸç›®ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚


## ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

ã¾ãšã€ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œã‚Šå§‹ã‚ãŸçµŒç·¯ã‚’ãŠè©±ã—ã—ã¾ã™ã€‚  

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç­‰ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®UIã¯ã€æ—¢å­˜ã®æ±ç”¨çš„ãªUIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã‚«ãƒãƒ¼å‡ºæ¥ãªã„éƒ¨åˆ†ãŒã‚ã‚Šã¾ã—ãŸã€‚ä»£è¡¨çš„ãªã‚‚ã®ã§è¨€ãˆã°ã€Rotary Knob (å›è»¢ãƒãƒ–)ã‚„ã€éµç›¤ãªã©ã§ã™ã€‚

ã¾ãŸã€æ—¢å­˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆãã‚ã‚‹ Slider ãªã©ã§ã‚‚ã€å¯¾æ•°çš„ãªè¡¨ç¤º (skew) ã‚’å®Ÿè£…ã™ã‚‹ã®ãŒå¤§å¤‰ã ã£ãŸã‚Šã—ã¾ã—ãŸã€‚

ãã“ã§ç¾åœ¨é–‹ç™ºã—ã¦ã„ã‚‹ã®ãŒã€**tremolo-ui** ã§ã™

https://github.com/m1m0zzz/tremolo-ui

tremolo-ui ã§ã¯ä»¥ä¸‹ã®ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¦ã„ã¾ã™ã€‚

- ä½¿ã„ã‚„ã™ã•ã¨æ‹¡å¼µæ€§  
  â†’ ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹UIãƒ©ã‚¤ã‚¯ãƒ»ç‰¹æ®ŠãªUIã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç­‰
- ãƒ¢ãƒã‚¤ãƒ«ã‚µãƒãƒ¼ãƒˆ  
  â†’ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚‹JUCEã¨å…±ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã€ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚å˜ä¸€ã®ã‚³ãƒ¼ãƒ‰ã§å‹•ãã“ã¨


{/* truncate */}

## ç”»é¢ã‚’ä½œã£ã¦ã„ã

ä»Šå›ä½¿ç”¨ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€

- JUCE: 8.0.4
- @tremolo-ui/react: 0.0.3
- juce-framework-frontend-mirror: 7.0.11
- react: 18.3.1

ã§ã™ã€‚ãã®ä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€[/webview/package.json](https://github.com/m1m0zzz/tremolo-ui-juce-example/blob/main/webview/package.json) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


ä»Šå›ã€è¨˜äº‹ã‚„ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ã«ã‚ãŸã‚Šã€[Kashiwade](https://x.com/Kashiwade_music) ã•ã‚“ã® [ã“ã¡ã‚‰](https://trap.jp/post/2307/) ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ã„ã¦ã„ã¾ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚  
JUCEã§WebViewã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ãªã©ã€è©³ã—ãæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã®ã§ã€å…ˆã«ã“ã¡ã‚‰ã‚’èª­ã‚“ã æ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### å®Œæˆå“

<Video src={captureVideo} />


ã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã«ã‚ã‚Šã¾ã™ã€‚

https://github.com/m1m0zzz/tremolo-ui-juce-example


JUCEå´ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã“ã‚Œã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ä½¿ã£ã¦ãã ã•ã„ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®é–‹ç™ºãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ [vite](https://ja.vite.dev/) ã‚’ä½¿ã„é››å‹ã‚’ä½œã‚Šã¾ã™ã€‚

```bash npm2yarn
npm init vite@latest
```

{/*
TODO: `init` to `create` 
https://github.com/nebrelbug/npm-to-yarn/issues/62
*/}

åå‰æ±ºã‚ãŸã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã—ãŸã‚Šã—ã¾ã™ã€‚  
ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€React + TypeScript + SWC ã§ä½œæˆã—ã¾ã—ãŸã€‚

```bash npm2yarn
cd <project_name>
npm i
npm run start
```

å–ã‚Šæ•¢ãˆãšã€å®Ÿè¡Œå¾Œã«æ›¸ã„ã¦ã‚ã‚‹ã‚³ãƒãƒ³ãƒ‰ã«å¾“ã„ã€ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ä¸‹æº–å‚™

è‰²ã€…å¤‰æ›´ã—ã¾ã™

<details>
  <summary>webview/src/main.tsx</summary>

```tsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

if (import.meta.env.PROD) {
  const html = document.getElementsByTagName('html')[0]
  if (html) {
    html.oncontextmenu = (() => false)
  }
}

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
```
</details>


<details>
  <summary>webview/src/index.css</summary>

```css
:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body, html {
  height: 100%;
  overflow-x: hidden;
  user-select: none;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

h1 {
  font-size: 1.5em;
  line-height: 1.1;
}

#root {
  height: 100%;
}
```
</details>


<details>
  <summary>webview/src/App.tsx</summary>

```tsx
import { useState } from 'react'
import { getToggleState } from 'juce-framework-frontend-mirror'

import { JuceCombobox } from './components/JuceCombobox'
import { JuceKnob } from './components/JuceKnob'
import { JuceSlider } from './components/JuceSlider'
import { JuceTextbox } from './components/JuceTextbox'
import { JuceToggleSwitch } from './components/JuceToggleSwitch'

import styles from './App.module.css'

export default function App() {
  const toggleState = getToggleState("bypass")
  const [bypass, setBypass] = useState(toggleState.getValue());

  return (
    <div className={styles.container}>
      <div className={styles.power_button}>
        <JuceToggleSwitch identifier="bypass" inverted={true} onChange={setBypass} />
      </div>
      <div
        className={styles.cover}
        data-bypass={bypass}
      ></div>
      <main className={styles.main}>
        <h1>Pan</h1>
        <JuceKnob identifier="panAngle" />
        <JuceTextbox identifier="panAngle" digits={0} />
        <JuceCombobox identifier="panRule" />
        <h1>Gain</h1>
        <JuceSlider identifier="gain" isVertical={true} />
        <JuceTextbox identifier="gain" suffix="dB" />
      </main>
    </div>
  )
}
```
</details>

<details>
  <summary>webview/src/App.module.css</summary>

```css
.container {
  width: 100%;
  height: 100%;
  position: relative;
}

.power_button {
  position: absolute;
  top: 0.5rem;
  left: 50%;
  translate: calc(-50%);
  z-index: 1000;
}

.cover {
  display: block;
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: 200;
}

.cover[data-bypass="true"] {
  background-color: rgba(0, 0, 0,0.3);
}

.cover[data-bypass="false"] {
  display: none;
}

.main {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  height: 100%;
  padding-top: 4rem;
  padding-right: 1rem;
  padding-left: 1rem;
  padding-bottom: 1rem;
  text-align: center;
}
```
</details>


```tsx title="webview/src/index.css"
if (import.meta.env.PROD) {
  const html = document.getElementsByTagName('html')[0]
  if (html) {
    html.oncontextmenu = (() => false)
  }
}
```

ğŸ‘† ã“ã‚Œã§ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã®ã¿ã€å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç¦æ­¢ã—ã¦ã„ã¾ã™ã€‚

é–‹ç™ºä¸­ã¯ `console.log` ã§ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã¨æ€ã†ã®ã§ã€å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ãŒå‡ºã›ãŸæ–¹ãŒã„ã„ã§ã™ã€‚


```css title="webview/src/index.css"
body, html {
  user-select: none;
}
```

ğŸ‘† ãã—ã¦ã“ã‚ŒãŒæ„å¤–ã¨å¤§äº‹ã§ã€ãƒ†ã‚­ã‚¹ãƒˆãªã©ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç¯„å›²é¸æŠå‡ºæ¥ãªãã™ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã£ã½ã•ãŒæ¸›ã‚Šã¾ã™ã€‚


### JUCE ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…

Juceã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®å‡¦ç†ãŒå¿…è¦ã§ã€ã¾ãŸãã‚Œã‚’å†åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ãŸã‚ã«ã€`webview/src/components` ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šãã“ã«ã€JUCEã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ãƒ©ãƒƒãƒ—ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚


```tsx title="webview/src/components/JuceKnob.tsx"
import { useEffect, useState } from "react";
import { Knob } from "@tremolo-ui/react";
import { getSliderState } from "juce-framework-frontend-mirror";

interface Props {
  identifier: string;
}

export function JuceKnob({
  identifier
}: Props) {
  const sliderState = getSliderState(identifier);
  const [value, setValue] = useState(sliderState.getNormalisedValue());

  const handleChange = (newNormalisedValue: number) => {
    console.log(newNormalisedValue)
    sliderState.setNormalisedValue(newNormalisedValue);
  };

  useEffect(() => {
    const updateWebViewValue = () => {
      setValue(sliderState.getNormalisedValue());
    };

    const valueListenerId =
      sliderState.valueChangedEvent.addListener(updateWebViewValue);

    return () => {
      sliderState.valueChangedEvent.removeListener(valueListenerId);
    };
  }, [sliderState]);

  return (
    <Knob
      min={0}
      max={1}
      step={0.001}
      value={value}
      onChange={handleChange}
      startValue={0.5}
      enableWheel={['normalized', 0.1]}
      style={{display: 'block', width: '100%'}}
    />
  );
};
```

- `enableWheel` ã§ãƒã‚¦ã‚¹ã§å€¤ã‚’å¤‰æ›´ã™ã‚‹è¨­å®šãŒã§ãã¾ã™ã€‚
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒ–ã®è¨­å®šã§ã¯ã€å·¦ä¸‹ãŒå›è»¢ã®é–‹å§‹ã®ä½ç½®ã§ã™ãŒã€`startValue` ã‚’è¨­å®šã™ã‚‹ã¨ãã‚Œã‚’å¤‰æ›´ã§ãã¾ã™ã€‚


```tsx title="webview/src/components/JuceSlider.tsx"
import { useEffect, useState } from "react";
import { Slider } from "@tremolo-ui/react";
import { getSliderState } from "juce-framework-frontend-mirror";

interface Props {
  identifier: string;
  isVertical?: boolean;
}

export function JuceSlider({
  identifier,
  isVertical = false,
}: Props) {
  const sliderState = getSliderState(identifier);
  const [value, setValue] = useState<number>(sliderState.getNormalisedValue());

  const handleChange = (newNormalisedValue: number) => {
    sliderState.setNormalisedValue(newNormalisedValue);
  };

  useEffect(() => {
    const updateWebViewValue = () => {
      setValue(sliderState.getNormalisedValue());
    };

    const valueListenerId =
      sliderState.valueChangedEvent.addListener(updateWebViewValue);

    return () => {
      sliderState.valueChangedEvent.removeListener(valueListenerId);
    };
  }, [sliderState]);

  return (
    <Slider
      min={0}
      max={1}
      step={0.001}
      value={value}
      onChange={handleChange}
      direction={isVertical ? 'up' : 'right'}
      enableWheel={['normalized', 0.1]}
      style={{display: 'block', margin: '10px auto'}}
    />
  );
};
```

ä»Šå›ã®å®Ÿè£…ã¯ã€ã‹ãªã‚Šã‚·ãƒ³ãƒ—ãƒ«ãªã®ã§ã€ã‚ã¾ã‚Šè§£èª¬ã™ã‚‹æ‰€ãŒç„¡ã„ã§ã™ãŒã€

Sliderã®ä¸­ã« `SliderTrack` ã‚„ `SliderThumb` è¦ç´ ã‚’ç½®ãã¨ã€è¦ç´ ã‚’è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

å‚ç…§: [Storybook](https://tremolo-ui-sb-react.vercel.app/?path=/story/react-components-slider--custom-image)

---


[JuceTextBox(NumberInput)](https://github.com/m1m0zzz/tremolo-ui-juce-example/blob/1a0e1f16e23e5c5df3f3f024ff937f316fbbf3f0/webview/src/components/JuceTextbox.tsx) ã¨ [JuceComboBox(Select)](https://github.com/m1m0zzz/tremolo-ui-juce-example/blob/1a0e1f16e23e5c5df3f3f024ff937f316fbbf3f0/webview/src/components/JuceCombobox.tsx) ã¯ã€å…ƒè¨˜äº‹ã®[Ant Design](https://ant.design/) ã§ä½œã‚‰ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€Bypassãƒœã‚¿ãƒ³ãŒå‘³æ°—ãªãæ„Ÿã˜ãŸã®ã§ã€ã‚¢ãƒ—ãƒªå…¨ä½“ã®CSSã¨ã€ãƒœã‚¿ãƒ³ã®CSSç­‰ã‚’å¤‰æ›´ã—ã¦ã€é›»æºãƒœã‚¿ãƒ³çš„ãªãƒ‡ã‚¶ã‚¤ãƒ³ã«ã—ã¾ã—ãŸã€‚([ã‚³ãƒ¼ãƒ‰](https://github.com/m1m0zzz/tremolo-ui-juce-example/tree/1a0e1f16e23e5c5df3f3f024ff937f316fbbf3f0/webview/src/components/JuceToggleSwitch))

## GitHub/Storybookã§å…¬é–‹ã—ã¦ã„ã¾ã™

ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€tremolo-ui ã®ã‚³ãƒ¼ãƒ‰ã¯ã€GitHubã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚  
tremolo-ui ã«ã¤ã„ã¦ã¯ã€ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆã€ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚

- tremolo-ui ã®ãƒªãƒã‚¸ãƒˆãƒª: [m1m0zzz/tremolo-ui](https://github.com/m1m0zzz/tremolo-ui)
- ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒªãƒã‚¸ãƒˆãƒª: [m1m0zzz/tremolo-ui-juce-example](https://github.com/m1m0zzz/tremolo-ui-juce-example)


Storybook ä¸Šã§ã€UI ã®ç¢ºèªã‚‚ã§ãã¾ã™ã€‚

https://tremolo-ui-sb-react.vercel.app/

tremolo-ui ãŒå°‘ã—ã§ã‚‚ã„ã„ãªã¨æ€ã£ã¦ãã‚ŒãŸã‚‰ã€GitHub ã®ã‚¹ã‚¿ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼
